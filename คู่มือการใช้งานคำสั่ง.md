# คู่มือการใช้งานคำสั่ง SharkGPT (Command Manual)

## ระบบใหม่: Slash Command (กด / แล้วเลือกคำสั่งได้ทันที)

**หมายเหตุ:**
- คำสั่งที่ขึ้นต้นด้วย `/` สามารถกด `/` ใน Discord แล้วเลือกจากเมนูได้เลย
- คำสั่งแอดมิน (เช่น `/ปล่อยกู้`, `/approve_loan`, `/close_loan`) ใช้ได้เฉพาะ user id ที่อยู่ใน ADMIN_USER_IDS เท่านั้น (ดูไฟล์ config.py)

## รายการคำสั่งหลัก

| คำสั่ง             | ผู้ใช้ทั่วไป | แอดมิน (Whitelist) | คำอธิบาย |
|--------------------|:------------:|:------------------:|-----------|
| `/เบิก <จำนวน>`      | ✅           | ✅                 | ขอวงเงินกู้ SharkCredit |
| `/ประวัติ`          | ✅           | ✅                 | ดูประวัติการกู้ของตนเอง |
| `/ปล่อยกู้ <จำนวน>`  | ❌           | ✅                 | ปล่อยกู้ด่วน (ใครกดก่อนรับสิทธิ์) |
| `/approve_loan <loan_id>` | ❌      | ✅                 | อนุมัติวงเงินกู้ (ต้องทราบ loan_id) |
| `/close_loan <loan_id> <@user> <จำนวน>` | ❌ | ✅ | ปิดหนี้/ชำระหนี้ให้ผู้ใช้ |


## ตัวอย่างการใช้งาน

- `/เบิก 500`
  > ขอวงเงิน 500 เครดิต ระบบจะสุ่มข้อความตอบกลับและแจ้งแอดมินทาง DM
- `/ประวัติ`
  > ดูประวัติการกู้ของคุณเอง (แสดง loan_id, จำนวน, สถานะ)
- `/ปล่อยกู้ 200`
  > แอดมินปล่อยกู้ 200 เครดิต ใครกดปุ่มก่อนจะได้รับสิทธิ์ทันที
- `/approve_loan loanid1234`
  > แอดมินอนุมัติวงเงินกู้ loan_id ที่ระบุ
- `/close_loan loanid1234 @user 500`
  > แอดมินปิดหนี้ loan_id ที่ระบุให้ user และบันทึกธุรกรรม

---

## หมายเหตุสำหรับแอดมิน
- เฉพาะ user id ที่อยู่ใน `ADMIN_USER_IDS` (ดูใน config.py) เท่านั้นที่ใช้คำสั่งแอดมินได้
- หากต้องการเพิ่ม/ลบแอดมิน ให้แก้ไขไฟล์ config.py หรือกำหนดใน ENV `ADMIN_USER_IDS`

---

## ข้อดีของ Slash Command
- ไม่ต้องจำชื่อคำสั่งหรือพิมพ์ผิด
- Discord แนะนำ/เติมคำให้ทันที
- มีคำอธิบายและตัวอย่างในเมนู

---


## กลุ่ม: เงินกู้ / SharkLoan
คำสั่ง    ตัวอย่าง    อธิบาย 
!เบิก [จำนวน]    !เบิก 500    ขอวงเงินกู้, ส่งเข้า queue รอแอดมินอนุมัติ
!ดอก    !ดอก    ดูดอกเบี้ยปัจจุบันและยอดที่ต้องคืน
!คืน [จำนวน]    !คืน 200    ชำระเงินคืนทั้งหมดหรือบางส่วน
!ประวัติ    !ประวัติ    ดูรายการกู้-คืนย้อนหลัง
!แง้ม    !แง้ม    เช็กวงเงินกู้สูงสุดที่ขอได้

!ปล่อยกู้ [จำนวน]    !ปล่อยกู้ 500    **[Admin Only]** ปล่อยกู้ด่วน คนแรกที่กดปุ่มจะได้สิทธิ์กู้ทันที

- แอดมินใช้ `!ปล่อยกู้ [จำนวน]` เพื่อปล่อยกู้แบบเร็ว
- บอทจะส่งข้อความพร้อม **ปุ่มขอกู้เงิน** ลงแชท
- **คนแรกที่กดปุ่ม** จะได้รับสิทธิ์กู้เงินจำนวนนั้นทันที (สร้าง loan ให้ user นั้น)
- ปุ่มจะถูกปิดใช้งานทันทีเมื่อมีผู้รับสิทธิ์แล้ว
- ระบบจะแจ้งเตือนทั้งผู้ได้สิทธิ์และแอดมิน

**ตัวอย่าง:**
> แอดมิน: `!ปล่อยกู้ 500`
> SharkBot: "ปล่อยกู้ด่วน! 500 เครดิต คนแรกที่กดจะได้สิทธิ์ทันที!" [ขอกู้เงิน]
> @user1 กดปุ่ม → ได้รับสิทธิ์กู้ 500 เครดิต (loan_id: xxxx)
> แอดมินได้รับแจ้งเตือนใน DM


- เมื่อมีการใช้ `!เบิก [จำนวน]` ระบบจะส่งข้อความบันทึกธุรกรรม (pending) พร้อม **ปุ่ม** ให้แอดมินเลือก:
    - [✅ อนุมัติ] (Approve)
    - [❌ ปฏิเสธ] (Reject)
- เมื่อแอดมินกดปุ่ม:
    - ระบบจะอัปเดตสถานะในฐานข้อมูล (approved/rejected)
    - แจ้งผลในแชแนลทันที
    - ทุกธุรกรรมจะถูกบันทึกลงประวัติ สามารถดูย้อนหลังได้ด้วย `!ประวัติ`

**ตัวอย่าง:**
> @user ขอเบิก 500 SharkCredit
> [✅ อนุมัติ] [❌ ปฏิเสธ]

**แอดมินกดปุ่ม** → ระบบแจ้งผลและบันทึกประวัติ

!หลามรอด @user    !หลามรอด @user    แอดมินอนุมัติ queue การกู้
!หลามดาก @user    !หลามดาก @user    แอดมินปฏิเสธ queue การกู้
กลุ่ม: Wallet / เครดิต
คำสั่ง    ตัวอย่าง    อธิบาย
!เครดิต    !เครดิต    ดูยอดเครดิตในบัญชี
!โอน @user [จำนวน]    !โอน @user 100    โอน SharkCredit ให้ผู้อื่น
!รับ [จำนวน]    !รับ 50    รับเงินจาก queue ที่รออยู่
!claim    !claim    รับของรางวัล/คืน slot
!wallet    !wallet    ดูรายละเอียด SharkWallet ทั้งหมด
กลุ่ม: โปรไฟล์ / ความสัมพันธ์
| คำสั่ง | ตัวอย่าง | อธิบาย | |

Feedback submitted
Me

@plan แก้ใหม่ เราจะไม่ใช้ wallet แต่ผมจะโอนแล้วกดปุ่มอนุมิตเอง ให้บอทลงบันทึกแล้วแสดงผล

Revert
Edited
plan
+77
-79
 1
Open diff
แผนในไฟล์ plan ได้รับการอัปเดตเรียบร้อยแล้ว:

ตัดกลุ่ม wallet ออก
ระบบโอน SharkCredit จะเป็น manual (ขอโอน → แอดมินกดปุ่ม Approve/Reject ใน Discord)
ทุกธุรกรรมบอทจะบันทึกและแสดงผลในแชแนลทันที
สรุปโครงสร้างใหม่ (สำคัญ):

กลุ่มเงินกู้/เครดิต: เหมือนเดิม
กลุ่มโอน SharkCredit: ใช้ !โอน @user [จำนวน] เพื่อขอโอน, รอแอดมินกดปุ่มอนุมัติ, บอทบันทึกและแสดงผล
ไม่มี !wallet, !รับ, !claim อีกต่อไป
Workflow โอน SharkCredit (Manual):

User ใช้ !โอน @user [จำนวน]
Bot ลงบันทึกธุรกรรมแบบ pending + แจ้งในแชแนล
แอดมินกดปุ่ม Approve/Reject ใน Discord
Bot อัปเดตสถานะ, แสดงผลธุรกรรมทันที
หากต้องการตัวอย่างโค้ดหรือ import ที่ต้องใช้สำหรับระบบนี้ (เช่น Discord.py, ปุ่มอินเทอร์แอคทีฟ, ฐานข้อมูล), แจ้งได้เลยครับ!
หรือถ้าต้องการคู่มือการใช้งานฉบับใหม่ที่ตรงกับแผนล่าสุด สามารถขอได้ทันที

Feedback submitted
Me

เอกสารต้องต้องการคือ พวกคู่มือพัตณา ต้องรองรับการเปลี่ยนagent บ่อยๆได้ ใช้ API ภายนอกช่วยบอทตอบคำถามได้ agent ใหม่ต้องเข้าใจโปรเจคแม้ไม่มีcontexเดิม สร้าง memor project ด้วย

Revert
นี่คือแนวทางจัดทำเอกสารคู่มือพัฒนา (Developer Guide) สำหรับ sharkberg-bot ที่ออกแบบมาเพื่อให้ agent/นักพัฒนาคนใหม่เข้าใจโปรเจคได้ทันที แม้ไม่มี context เดิม และรองรับการเปลี่ยน agent หรือเพิ่มความสามารถผ่าน API ภายนอกได้สะดวก:
# คู่มือพัฒนา & Onboarding สำหรับ Sharkberg-bot

## 1. ภาพรวมโปรเจค (Project Overview)
sharkberg-bot คือ Discord Bot สำหรับชุมชนสล็อต/สายปั่น
สไตล์ตอบแชทแนวกวน/ปั่น
มีระบบ SharkLoan: กู้เงิน, คิวรออนุมัติ, ธุรกรรม manual (แอดมินกดปุ่มใน Discord)
ทุกธุรกรรมบันทึกลงฐานข้อมูล Supabase/PostgreSQL
ไม่มีระบบ wallet อัตโนมัติ ทุกการโอนต้องแอดมินอนุมัติ (Manual)
โครงสร้างโปรเจคแยกไฟล์ชัดเจน รองรับการเปลี่ยน agent ได้ง่าย
2. โครงสร้างไฟล์สำคัญ (File Structure)
ไฟล์/โฟลเดอร์    หน้าที่
constants.py
ค่าคงที่, config อัตราดอกเบี้ย ฯลฯ
create_supabase_schema.sql
c:\Users\HP\Desktop\sharkberg-bot\create_supabase_schema.sql
สร้างตาราง users, loans, transactions
create_credit_limits.sql
c:\Users\HP\Desktop\sharkberg-bot\create_credit_limits.sql
SQL สำหรับ credit limit
bot.py
logic หลักของ Discord Bot
db.py    ฟังก์ชันติดต่อฐานข้อมูล
commands/    handler ของแต่ละกลุ่มคำสั่ง
.env
TOKEN, API KEY, config สำคัญ
3. หลักการออกแบบ (Design Principles)
Modular: ทุกฟีเจอร์แยก handler/ไฟล์ชัดเจน
Agent Handoff Friendly: มีเอกสาร/คู่มือ onboarding, โค้ดอ่านง่าย, คอมเมนต์ครบ
### ฟังก์ชันฐานข้อมูล (DB Functions) ที่มีในระบบ
- get_user(user_id, guild_id): ดึงข้อมูล user
- create_loan(user_id, guild_id, amount): สร้าง loan ใหม่
- record_transaction(user_id, guild_id, loan_id, action, amount, interest, admin_id=None): บันทึกธุรกรรม (กู้, คืน, ดอกเบี้ย, ฯลฯ)
- update_credit_limit_on_interest_payment(user_id, guild_id, interest_paid): (ใหม่) เพิ่มวงเงินอัตโนมัติ 10% ของดอกเบี้ยที่จ่าย เรียกอัตโนมัติใน record_transaction เมื่อ action == 'pay' และ interest > 0
- sb_update_loan(loan_id, **fields): อัปเดตข้อมูล loan ตาม loan_id เช่นเปลี่ยนสถานะเป็น paid (wrap จาก supabase_helpers.update_loan)

> หมายเหตุ: ฟังก์ชัน update_credit_limit_on_interest_payment จะไม่แสดง logic การเพิ่มวงเงินให้ user โดยตรงใน UI/Embed แต่ระบบจะอัปเดตวงเงินในฐานข้อมูลทุกครั้งที่มีการจ่ายดอกเบี้ย

---
5. ตัวอย่างการรันบอท (Run Bot)
สร้างไฟล์ 
.env
 ใส่ DISCORD_TOKEN, DB_URL, API_KEY ฯลฯ
ติดตั้ง dependencies:
bash
pip install -r requirements.txt
รันบอท:
bash
python bot.py
6. ตัวอย่างการใช้ External API
python
def ask_external_api(question):
    url = "https://api.example.com/ask"
    resp = requests.post(url, json={"q": question})
    return resp.json().get("answer")
สามารถนำไปใช้ใน command handler เพื่อให้บอทตอบคำถาม/หาข้อมูลนอกโปรเจค
7. Command Mapping (ย่อ)
!เบิก [จำนวน] — ขอวงเงินกู้, insert queue
!ดอก — ดูดอกเบี้ย
!คืน [จำนวน] — ชำระเงิน
!โอน @user [จำนวน] — ขอโอน SharkCredit (รอแอดมินกดปุ่ม)
!หลามรอด / !หลามดาก — แอดมินอนุมัติ/ปฏิเสธ
ฯลฯ (ดูรายละเอียดในไฟล์ plan)
8. Memory Project (สำหรับ Agent ใหม่)
โปรเจคนี้ออกแบบให้เปลี่ยน agent ได้ตลอด
มี memory/summary สั้นๆ อัปเดตไว้เสมอ (ดูหัวข้อ “Sharkberg-bot: Project Memory & Onboarding Summary”)
ทุก agent ใหม่ควรอ่านไฟล์ plan, constants.py, create_supabase_schema.sql, db.py, commands/ ก่อนเริ่ม
9. Best Practice สำหรับ Agent ใหม่
อ่านไฟล์ plan และ summary ก่อน
ใช้ import ให้ตรงกับตัวอย่างในคู่มือ
ทุกการรัน/ทดสอบ/แก้ไข ต้อง log ธุรกรรมและแสดงผลในแชแนล
หากเพิ่มฟีเจอร์ใหม่ ให้แยก handler/ไฟล์ และอัปเดตเอกสารทุกครั้ง
ถ้าต้องเรียก API ภายนอกให้แยกฟังก์ชันไว้ชัดเจน
